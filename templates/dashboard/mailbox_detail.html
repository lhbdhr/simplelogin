{% extends "default.html" %}

{% set active_page = "mailbox" %}
{% block title %} æ”¶ä»¶é‚®ç®± {{ mailbox.email }}{% endblock %}
{% block head %}

  <style>
      div[disabled]
      {
          pointer-events: none;
          opacity: 0.7;
      }
  </style>
{% endblock %}
{% block default_content %}

  <div class="row">
    <div class="col">
      <h1 class="h3">
        {{ mailbox.email }}
        {% if mailbox.verified %}

          <span class="cursor"
                data-toggle="tooltip"
                data-original-title="æ”¶ä»¶é‚®ç®±å·²éªŒè¯">âœ…</span>
        {% else %}
          <span class="cursor"
                data-toggle="tooltip"
                data-original-title="æ”¶ä»¶é‚®ç®±æœªéªŒè¯">ğŸš«</span>
        {% endif %}
        {% if mailbox.pgp_enabled() %}

          <span class="cursor"
                data-toggle="tooltip"
                data-original-title="PGP å·²å¯ç”¨">ğŸ—</span>
        {% endif %}
      </h1>
      {% if not mailbox.verified %}

        <div class="alert alert-info">
          é‚®ç®±æœªéªŒè¯ï¼Œè¯·æ£€æŸ¥æ‚¨çš„æ”¶ä»¶ç®±/åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹ä¸­æ˜¯å¦æœ‰éªŒè¯é‚®ä»¶ã€‚
          <br />
          è¦å†æ¬¡æ”¶åˆ°éªŒè¯é‚®ä»¶ï¼Œæ‚¨å¯ä»¥åˆ é™¤å¹¶é‡æ–°æ·»åŠ é‚®ç®±ã€‚
        </div>
      {% endif %}
      <!-- Change email -->
      <div class="card">
        <form method="post" enctype="multipart/form-data">
          <input type="hidden" name="form-name" value="update-email">
          {{ change_email_form.csrf_token }}
          <div class="card-body">
            <div class="card-title">æ›´æ”¹æ”¶ä»¶é‚®ç®±åœ°å€</div>
            <div class="form-group">
              <label class="form-label">åœ°å€</label>
              <!-- Not allow user to change mailbox if there's a pending change -->
              {{ change_email_form.email(class="form-control", value=mailbox.email, readonly=pending_email != None) }}
              {{ render_field_errors(change_email_form.email) }}
              {% if pending_email %}

                <div class="mt-2">
                  <span class="text-danger">æ›´æ”¹ä¸­: {{ pending_email }}</span>
                  <a href="{{ url_for('dashboard.cancel_mailbox_change_route', mailbox_id=mailbox.id) }}"
                     class="btn btn-secondary btn-sm">å–æ¶ˆæ”¶ä»¶é‚®ç®±å˜æ›´</a>
                </div>
              {% endif %}
            </div>
            <button class="btn btn-primary">ä¿®æ”¹</button>
          </div>
        </form>
      </div>
      <!-- END Change email -->
      <!-- Not show PGP option for Proton mailbox -->
      {% if mailbox.is_proton() and not mailbox.pgp_enabled() %}

        <div class="alert alert-info">
          ç”±äº Proton Mail ä¸­çš„ç”µå­é‚®ä»¶å§‹ç»ˆå¤„äºé™æ€åŠ å¯†çŠ¶æ€ï¼Œå› æ­¤è®© åŸé‚®é‚®ç®± ä¹ŸåŠ å¯†æ‚¨çš„ç”µå­é‚®ä»¶æ˜¯å¤šä½™çš„ï¼Œå¹¶ä¸”ä¸ä¼šå¢åŠ ä»»ä½•å®‰å…¨ä¼˜åŠ¿ã€‚
          <br>
          å½“æ‚¨çš„é‚®ç®±æä¾›å•†ï¼ˆå¦‚ Gmail/Outlook ç­‰ï¼‰é»˜è®¤ä¸åŠ å¯†æ—¶ï¼ŒåŸé‚®é‚®ç®± ä¸Šçš„ PGP é€‰é¡¹å¾ˆæœ‰ç”¨ã€‚
        </div>
      {% endif %}
      <div class="{% if mailbox.is_proton() and not mailbox.pgp_enabled() %}
         disabled-content{% endif %}">
        {% if mailbox.pgp_finger_print and not mailbox.disable_pgp and current_user.include_sender_in_reverse_alias and not mailbox.is_proton() %}

          <div class="alert alert-info">
            ç”µå­é‚®ä»¶æ ‡å¤´ï¼ˆå¦‚<span class="italic">å‘ä»¶äººã€æ”¶ä»¶äººã€ä¸»é¢˜</span>ï¼‰æœªé€šè¿‡ PGP åŠ å¯†ã€‚
            ç›®å‰ï¼Œæ‚¨çš„åå‘åˆ«ååŒ…å«å‘ä»¶äººåœ°å€ã€‚
            æ‚¨å¯ä»¥åœ¨<a href="/dashboard/setting#sender-in-ra">è®¾ç½®</a>ä¸­ç¦ç”¨æ­¤åŠŸèƒ½ã€‚
          </div>
        {% endif %}
        <div class="card">
          <div class="card-body">
            <div class="card-title">
              <div class="d-flex">
                ç”µå­é‚®ä»¶åŠ å¯† (PGP)
                {% if mailbox.pgp_finger_print %}

                  <form method="post">
                    {{ csrf_form.csrf_token }}
                    <input type="hidden" name="form-name" value="toggle-pgp">
                    <label class="custom-switch cursor" style="padding-left: 1rem" data-toggle="tooltip" {% if mailbox.disable_pgp %}
                       title="å¯ç”¨ PGP" {% else %} title="ç¦ç”¨ PGP" {% endif %}>
                      <input type="checkbox" class="custom-switch-input" name="pgp-enabled" {{ "" if mailbox.disable_pgp else "checked" }}>
                      <span class="custom-switch-indicator"></span>
                    </label>
                  </form>
                {% endif %}
              </div>
              <div class="small-text mt-1">
                é€šè¿‡å°†æ‚¨çš„ PGP å…¬é’¥å¯¼å…¥ SimpleLoginï¼Œæ‰€æœ‰å‘é€åˆ° {{ mailbox.email }} çš„ç”µå­é‚®ä»¶éƒ½å°†ä½¿ç”¨æ‚¨çš„å¯†é’¥è¿›è¡Œ
                <b>åŠ å¯†</b>ã€‚
                <br />
                {% if PGP_SIGNER %}æ‰€æœ‰è½¬å‘çš„ç”µå­é‚®ä»¶éƒ½å°†ä½¿ç”¨ <b>{{ PGP_SIGNER }}</b> è¿›è¡Œç­¾åã€‚{% endif %}
              </div>
            </div>
            {% if not current_user.is_premium() %}

              <div class="alert alert-danger" role="alert">æ­¤åŠŸèƒ½ä»…åœ¨é«˜çº§è®¡åˆ’ä¸­å¯ç”¨ã€‚</div>
            {% endif %}
            <form method="post">
              {{ csrf_form.csrf_token }}
              <div class="form-group">
                <label class="form-label">PGP å…¬é’¥</label>
                <textarea name="pgp"
                          {% if not current_user.is_premium() %}disabled{% endif %}
                          class="form-control"
                          rows="10"
                          id="pgp-public-key"
                          placeholder="(å°†æ‚¨çš„ pgp å…¬é’¥æ‹–æ”¾æˆ–ç²˜è´´åˆ°æ­¤å¤„)&#10;-----BEGIN PGP PUBLIC KEY BLOCK-----">{{ mailbox.pgp_public_key or "" }}</textarea>
              </div>
              <input type="hidden" name="form-name" value="pgp">
              <button class="btn btn-primary" name="action" {% if not current_user.is_premium() %}disabled{% endif %} value="save">ä¿å­˜</button>
              {% if mailbox.pgp_finger_print %}

                <button class="btn btn-danger float-right" name="action" value="remove">ç§»é™¤</button>
              {% endif %}
            </form>
          </div>
        </div>
      </div>
      <div class="card" id="generic-subject">
        <form method="post" action="#generic-subject">
          {{ csrf_form.csrf_token }}
          <input type="hidden" name="form-name" value="generic-subject">
          <div class="card-body">
            <div class="card-title">
              éšè—ç”µå­é‚®ä»¶ä¸»é¢˜
              <div class="small-text mt-1">
                åŸå§‹ä¸»é¢˜å°†æ·»åŠ åˆ°ç”µå­é‚®ä»¶æ­£æ–‡ä¸­ï¼Œæ‰€æœ‰è½¬å‘çš„ç”µå­é‚®ä»¶éƒ½å°†å…·æœ‰é€šç”¨ä¸»é¢˜ã€‚
                <br />
                æ­¤é€‰é¡¹é€šå¸¸åœ¨å¯ç”¨ PGP æ—¶ä½¿ç”¨ã€‚
                ç”±äº PGP ä¸åŠ å¯†ç”µå­é‚®ä»¶ä¸»é¢˜ï¼Œå› æ­¤å®ƒå¯ä»¥è¿›ä¸€æ­¥ä¿æŠ¤æ‚¨çš„ç”µå­é‚®ä»¶å†…å®¹ã€‚
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">é€šç”¨ä¸»é¢˜</label>
              <input name="generic-subject"
                     class="form-control"
                     maxlength="78"
                     placeholder="è¿™æ˜¯ä¸€å°åŠ å¯†çš„ç”µå­é‚®ä»¶"
                     value="{{ mailbox.generic_subject or "" }}">
            </div>
            <button class="btn btn-primary" name="action" value="save">ä¿å­˜</button>
            {% if mailbox.generic_subject %}

              <button class="btn btn-danger float-right" name="action" value="remove">ç§»é™¤</button>
            {% endif %}
          </div>
        </form>
      </div>
      <hr />
      <h2 class="h4">é«˜çº§é€‰é¡¹</h2>
      {% if spf_available %}

        <div class="card" id="spf">
          <form method="post">
            {{ csrf_form.csrf_token }}
            <input type="hidden" name="form-name" value="force-spf">
            <div class="card-body">
              <div class="card-title">
                å¼ºåˆ¶ SPF
                <div class="small-text">
                  ä¸ºäº†é˜²æ­¢ç”µå­é‚®ä»¶æ¬ºéª—ï¼ŒåŸé‚®é‚®ç®± ä¼šé˜»æ­¢ä»¥ä¸‹ç”µå­é‚®ä»¶
                  <em data-toggle="tooltip"
                    title="ä»¥æ‚¨çš„é‚®ç®±ä½œä¸ºå‘ä»¶äººåœ°å€çš„ç”µå­é‚®ä»¶">ä¼¼ä¹</em>æ¥è‡ªæ‚¨çš„
                    é‚®ç®±,
                    ä½†å‘é€è‡ª
                  <em data-toggle="tooltip"
                    title="æ‚¨çš„é‚®ç®±ç”µå­é‚®ä»¶æœåŠ¡ä¸çŸ¥é“çš„ IP åœ°å€">æœªçŸ¥</em>
                    IP åœ°å€.
                  <br />
                  ä»…å½“æ‚¨çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆæ—¶æ‰å…³é—­æ­¤é€‰é¡¹:)ã€‚
                </div>
              </div>
              <label class="custom-switch cursor mt-2 pl-0" data-toggle="tooltip" {% if mailbox.force_spf %}
                 title="Disable SPF enforcement" {% else %} title="å¯ç”¨ SPF å¼ºåˆ¶æ‰§è¡Œ" {% endif %}>
                <input type="checkbox" name="spf-status" class="custom-switch-input" {{ "checked" if mailbox.force_spf else "" }}>
                <span class="custom-switch-indicator"></span>
              </label>
            </div>
          </form>
        </div>
      {% endif %}
      <div class="card" id="authorized-address">
        <div class="card-body">
          <div class="card-title">
            æˆæƒé‚®ç®±åœ°å€
            <div class="small-text">
              ä»è¿™äº›åœ°å€å‘é€åˆ°<b>åå‘åˆ«å</b>çš„ç”µå­é‚®ä»¶å°†è¢«è§†ä¸ºæ¥è‡ª {{ mailbox.email }}
            </div>
          </div>
          {% if mailbox.authorized_addresses | length == 0 %}

          {% else %}
            <ul>
              {% for authorized_address in mailbox.authorized_addresses %}

                <li>
                  {{ authorized_address.email }}
                  <form method="post" action="#authorized-address" style="display: inline">
                    {{ csrf_form.csrf_token }}
                    <input type="hidden" name="form-name" value="delete-authorized-address">
                    <input type="hidden"
                           name="authorized-address-id"
                           value="{{ authorized_address.id }}">
                    <input type="submit" class="btn btn-sm btn-outline-warning" value="åˆ é™¤">
                  </form>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
          <form method="post" action="#authorized-address" class="form-inline">
            {{ csrf_form.csrf_token }}
            <input type="hidden" name="form-name" value="add-authorized-address">
            <input type="email" name="email" size="50" class="form-control" required>
            <input type="submit" class="btn btn-primary" value="æ·»åŠ ">
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block script %}
  <script src="/static/js/utils/drag-drop-into-text.js"></script>
  <script>
    $(".custom-switch-input").change(function (e) {
      $(this).closest("form").submit();
    });
    enableDragDropForPGPKeys('#pgp-public-key');
  </script>
{% endblock %}
