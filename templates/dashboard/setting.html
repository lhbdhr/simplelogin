{% extends "default.html" %}

{% set active_page = "setting" %}
{% block title %}设置{% endblock %}
{% block head %}

  <style>
      .card-title {
          font-size: 22px;
          font-weight: 600;
          margin-bottom: 3px;
      }
      .highlighted{
          border: solid 2px #5675E2;
      }
      li {
      margin-top: 8px;
  }

  </style>
{% endblock %}
{% block default_content %}

  <div class="col pb-3">
    <!-- Current plan -->
    <div class="card">
      <div class="card-body">
        <div class="card-title mb-3">当前计划</div>
        {% if current_user.lifetime %}

          您可以终身使用高级会员计划。
        {% elif current_user.lifetime_or_active_subscription() %}
          {% if paddle_sub %}

            <div>
              {% if paddle_sub.cancelled %}(取消){% endif %}
              通过 Paddle 订阅的 {{ paddle_sub.plan_name() }} 计划.
              <a href="{{ url_for("dashboard.billing") }}">管理订阅计划 ➡</a>
            </div>
          {% endif %}
          {% if manual_sub and manual_sub.is_active() %}

            <div>
              手动计划订阅过期于 {{ manual_sub.end_at | dt }}
              ({{ manual_sub.end_at.format("YYYY-MM-DD") }}).
              {% if manual_sub.is_giveaway %}

                <br />
                要获得附加功能并支持 原邮邮箱，您可以升级到高级计划。
                <br />
                <a href="{{ url_for("dashboard.pricing") }}"
                   class="btn btn-sm btn-outline-primary">升级</a>
              {% endif %}
            </div>
          {% endif %}
          {% if apple_sub and apple_sub.is_valid() %}

            <div>
              通过 Apple 订阅的高级计划将过期于 {{ apple_sub.expires_date | dt }}
              ({{ apple_sub.expires_date.format("YYYY-MM-DD") }}).
              <div class="alert alert-info">
                如果您想通过网络订阅，请务必先在 Apple 上取消订阅。
                <a href="{{ url_for("dashboard.pricing") }}">
                  升级 <i class="fa fa-arrow-right" aria-hidden="true"></i>
                </a>
              </div>
            </div>
          {% endif %}
          {% if coinbase_sub and coinbase_sub.is_active() %}

            <div>
              使用加密货币订阅的高级计划将过期于
              {{ coinbase_sub.end_at.format("YYYY-MM-DD") }}.
              <a href="{{ url_for("dashboard.coinbase_checkout_route") }}"
                 target="_blank"
                 rel="noopener noreferrer">
                延长订阅时间 <i class="fe fe-external-link"></i>
              </a>
            </div>
          {% endif %}
          {% if partner_sub %}
            {% if partner_sub.lifetime %}

              <div>高级终身订阅由 {{ partner_name }}.</div>
            {% else %}
              <div>高级订阅由 {{ partner_name }}.</div>
            {% endif %}
          {% endif %}
        {% elif current_user.in_trial() %}
          您的 高级会员试用 过期于 {{ current_user.trial_end | dt }}.
        {% else %}
          您采用的是免费计划。
        {% endif %}
      </div>
    </div>
    <!-- END Current plan -->
    <!-- Newsletter -->
    <div class="card" id="notification">
      <div class="card-body">
        <div class="card-title">时事通讯</div>
        <div class="mb-3">我们会偶尔向您发送包含新功能公告的电子邮件。</div>
        <form method="post">
          {{ csrf_form.csrf_token }}
          <input type="hidden" name="form-name" value="notification-preference">
          <div class="form-check">
            <input type="checkbox" id="notification" name="notification" {% if current_user.notification %}checked{% endif %} class="form-check-input">
              <label for="notification">我希望在新功能发布时收到电子邮件通知。</label>
            </div>
            <button type="submit" class="btn btn-outline-primary">保存</button>
          </form>
        </div>
      </div>
      <!-- END Newsletter -->
      <!-- Change name & profile picture -->
      <div class="card">
        <form method="post" enctype="multipart/form-data">
          {{ form.csrf_token }}
          <input type="hidden" name="form-name" value="update-profile">
          <div class="card-body">
            <div class="card-title">个人资料</div>
            <div>
              当您使用
              <span class="text-success">原邮邮箱</span> 帐号，一键登录其他网站时，此信息将自动填写。
            </div>
            <div class="form-group mt-3">
              <label class="form-label">姓名</label>
              {{ form.name(class="form-control", value=current_user.name) }}
              {{ render_field_errors(form.name) }}
            </div>
            <div class="form-group">
              <div class="form-label">个人资料头像</div>
              {{ form.profile_picture(class="form-control-file") }}
              {{ render_field_errors(form.profile_picture) }}
              {% if current_user.profile_picture_id %}

                <img src="{{ current_user.profile_picture_url() }}"
                     class="profile-picture">
              {% endif %}
            </div>
            <button class="btn btn-outline-primary">保存</button>
          </div>
        </form>
      </div>
      <!-- END change name & profile picture -->
      <!-- Connect with Proton -->
      <div class="card" id="connect-with-proton">
        <div class="card-body">
          <div class="card-title">账号连接</div>
          <div class="mb-3">
            您可以将您的 Google/LinuxDo 账户 和 原邮邮箱 帐户连接。
            <br>
            然后，您可以使用 Google/LinuxDo 帐户快速登录到您的 原邮邮箱 帐户。
            <br />
          </div>
          {% if google_linked_account != None %}

            <form class="d-inline"
                  method="post"
                  action="{{ url_for("dashboard.unlink_google_account") }}">
              {{ csrf_form.csrf_token }}
              <button class="btn btn-primary mt-2" style="color:#000;background-color:#fff">
                <img class="mr-2" width="24px" src="/static/images/google.svg">
                取消 和 Google 账号 连接
              </button>
            </form>
          {% else %}
            <a class="btn btn-primary mt-2"
               style="color:#000;
                      background-color:#fff"
               href="{{ url_for("auth.google_login", action="link") }}">
              <img class="mr-2" width="24px" src="/static/images/google.svg">
              和 Google 账号 连接
            </a>
          {% endif %}
          {% if linuxdo_linked_account != None %}

            <form method="post"
                  class="d-inline"
                  action="{{ url_for("dashboard.unlink_linuxdo_account") }}">
              {{ csrf_form.csrf_token }}
              <button class="btn btn-primary mt-2 "
                      style="color:#000;
                             background-color:#fff">
                <img class="mr-2" height="24px" src="/static/images/linuxdo.svg">
                取消 和 LinuxDo 账号 连接
              </button>
            </form>
          {% else %}
            <a class="btn btn-primary mt-2 proton-button"
               style="color:#000;
                      background-color:#fff"
               href="{{ url_for("auth.linuxdo_login", action="link") }}">
              <img class="mr-2"
                   height="24px"
                   src="{{ url_for('static', filename='images/linuxdo.svg') }}" />
              和 LinuxDo 账号 连接
            </a>
          {% endif %}
        </div>
      </div>
      <!-- END Connect with Proton -->
      <!-- is_alias_suffix -->
      <div class="card" id="is-alias-suffix">
        <div class="card-body">
          <div class="card-title">
            别名随机后缀
            <div class="badge badge-warning">仅付费用户可用</div>
          </div>
          <div class="my-3">
            <p>
              禁用后可以生成类似 <span class="text-success font-weight-bold">xxxx@yyyx.uk</span> 格式的别名
            </p>
            <p>
              禁止新建特殊别名地址，比如 <span class="text-success font-weight-bold">admin@yyyx.uk</span>。
              类似的关键词还有 root sale info support abuse mail postmaster mailer 等等等等，
              <br />
              如果创建这类别名，会导致别名被删除！
            </p>
            <p>
              推荐使用你自己常用的用户名+使用这个别名的网站，
              比如 <span class="text-success font-weight-bold">username + website =  coolbwg@yyyx.uk</span>
              <br />
              这样不容易重复，而且不容易无意中创建了特殊地址，导致别名被删除。
            </p>
          </div>
          <form method="post" action="#is-alias-suffix">
            {{ csrf_form.csrf_token }}
            <input type="hidden" name="form-name" value="alias-suffix">
            <div class="form-check">
              <input type="checkbox" id="alias-suffix" name="alias-suffix" {% if current_user.is_alias_suffix %}checked{% endif %} class="form-check-input">
                <label for="alias-suffix">启用别名随机后缀</label>
              </div>
              <button type="submit" class="btn btn-outline-primary">保存</button>
            </form>
          </div>
        </div>
        <!-- END alias_suffix -->
        <!-- Random alias -->
        <div id="random-alias" class="card">
          <div class="card-body">
            <div class="card-title">别名设置</div>
            <div class="mt-3 mb-1">更改默认生成随机别名的方式。</div>
            <form method="post" action="#random-alias" class="form-inline">
              {{ csrf_form.csrf_token }}
              <input type="hidden" name="form-name" value="change-alias-generator">
              <select class="form-control mr-sm-2" name="alias-generator-scheme">
                <option value="{{ AliasGeneratorEnum.word.value }}" {% if current_user.alias_generator == AliasGeneratorEnum.word.value %}selected{% endif %}>基于随机单词</option>
                <option value="{{ AliasGeneratorEnum.uuid.value }}" {% if current_user.alias_generator == AliasGeneratorEnum.uuid.value %}selected{% endif %}>基于 UUID</option>
              </select>
              <button class="btn btn-outline-primary">保存</button>
            </form>
            <div class="mt-3 mb-1">选择别名的默认域名。</div>
            <form method="post" action="#random-alias" class="form-inline">
              {{ csrf_form.csrf_token }}
              <input type="hidden"
                     name="form-name"
                     value="change-random-alias-default-domain">
              <select class="form-control mr-sm-2" name="random-alias-default-domain">
                <option value="">未选择</option>
                {% for is_public, domain in current_user.available_domains_for_random_alias() %}

                  <option value="{{ domain }}" {% if current_user.default_alias_custom_domain_id or current_user.default_alias_public_domain_id %}
                     {% if current_user.default_random_alias_domain() == domain %}selected{% endif %} {% endif %}>
                    {{ domain }} (
                    {% if is_public %}

                      原邮邮箱域名
                    {% else %}
                      你的域名
                    {% endif %}
                    )
                  </option>
                {% endfor %}
              </select>
              <button class="btn btn-outline-primary">保存</button>
            </form>
            <div id="random-alias-suffix" class="mt-3 mb-1">选择别名的默认后缀生成器。</div>
            <form method="post" action="#random-alias-suffix" class="form-inline">
              {{ csrf_form.csrf_token }}
              <input type="hidden" name="form-name" value="random-alias-suffix">
              <select class="form-control mr-sm-2" name="random-alias-suffix-generator">
                <option value="0" {% if current_user.random_alias_suffix==0 %}selected{% endif %}>来自我们词典的随机单词</option>
                <option value="1" {% if current_user.random_alias_suffix==1 %}selected{% endif %}>{{ ALIAS_RAND_SUFFIX_LENGTH }} 个字母和数字的随机组合</option>
              </select>
              <button class="btn btn-outline-primary">保存</button>
            </form>
          </div>
        </div>
        <!-- END Random alias -->
        <!-- Data breach check -->
        <div class="card" id="data-breach">
          <div class="card-body">
            <div class="card-title">数据泄露监控</div>
            <div class="mt-1 mb-3">
              {% if not current_user.is_premium() %}

                <div class="alert alert-info" role="alert">
                  此功能仅在高级计划中可用。
                  <a href="{{ url_for("dashboard.pricing") }}"
                     target="_blank"
                     rel="noopener noreferrer">
                    升级<i class="fe fe-external-link"></i>
                  </a>
                </div>
              {% endif %}
              如果启用，当您的某个别名出现数据泄露时，我们会通过电子邮件通知您。
              <br>
              原邮邮箱 使用 <a href="https://haveibeenpwned.com/">HaveIBeenPwned</a> API 来检查数据泄露。
            </div>
            <form method="post" action="#data-breach">
              {{ csrf_form.csrf_token }}
              <input type="hidden" name="form-name" value="enable_data_breach_check">
              <div class="form-check">
                <input type="checkbox" id="enable_data_breach_check" name="enable_data_breach_check" {% if current_user.enable_data_breach_check %}checked{% endif %} class="form-check-input">
                  <label for="enable_data_breach_check">启用数据泄露监控</label>
                </div>
                <button type="submit" class="btn btn-outline-primary">保存</button>
              </form>
            </div>
          </div>
          <!-- END Data breach check -->
          <!-- Sender Format -->
          <div class="card" id="sender-format">
            <div class="card-body">
              <div class="card-title">发件人地址格式</div>
              <div class="mt-1 mb-3">
                当您的别名收到一封电子邮件时，例如发件人：<b>John Wick &lt;john@wick.com&gt;</b>，
                原邮邮箱 会将其转发到您的邮箱。
                <br />
                由于某些电子邮件限制，原邮邮箱 无法保留发件人电子邮件地址的原始格式，需要将其<b>转换</b>为以下格式之一。
              </div>
              <form method="post" action="#sender-format">
                {{ csrf_form.csrf_token }}
                <input type="hidden" name="form-name" value="change-sender-format">
                <select class="form-control mr-sm-2" name="sender-format">
                  <option value="{{ SenderFormatEnum.AT.value }}" {% if current_user.sender_format == SenderFormatEnum.AT.value %}selected{% endif %}>John Wick - john at wick.com</option>
                  <option value="{{ SenderFormatEnum.A.value }}" {% if current_user.sender_format == SenderFormatEnum.A.value %}selected{% endif %}>John Wick - john(a)wick.com</option>
                  <option value="{{ SenderFormatEnum.NAME_ONLY.value }}" {% if current_user.sender_format == SenderFormatEnum.NAME_ONLY.value %}selected{% endif %}>John Wick</option>
                  <option value="{{ SenderFormatEnum.AT_ONLY.value }}" {% if current_user.sender_format == SenderFormatEnum.AT_ONLY.value %}selected{% endif %}>john at wick.com</option>
                  <option value="{{ SenderFormatEnum.NO_NAME.value }}" {% if current_user.sender_format == SenderFormatEnum.NO_NAME.value %}selected{% endif %}>No Name (i.e. only reverse-alias)</option>
                </select>
                <button class="btn btn-outline-primary mt-3">保存</button>
              </form>
            </div>
          </div>
          <!-- END Sender Format -->
          <!-- Reverse-alias replacement -->
          <div class="card" id="reverse-alias-replacement-section">
            <div class="card-body">
              <div class="card-title">
                反向别名替换
                <div class="badge badge-warning">实验功能</div>
              </div>
              <div class="mb-3">
                回复转发的电子邮件时，您的电子邮件客户端会自动将<b>反向别名</b>包含在附加消息中。
                如果启用此选项，原邮邮箱 将尝试用您的联系电子邮件<b>替换</b>反向别名。
                <br />
              </div>
              <form method="post" action="#reverse-alias-replacement-section">
                {{ csrf_form.csrf_token }}
                <input type="hidden" name="form-name" value="replace-ra">
                <div class="form-check">
                  <input type="checkbox" id="replace-ra" name="replace-ra" {% if current_user.replace_reverse_alias %}checked{% endif %} class="form-check-input">
                    <label for="replace-ra">启用替换反向别名</label>
                  </div>
                  <button type="submit" class="btn btn-outline-primary">保存</button>
                </form>
              </div>
            </div>
            <!-- END Reverse-alias -->
            <!-- Sender included in reverse-alias -->
            <div class="card" id="sender-in-ra">
              <div class="card-body">
                <div class="card-title">在反向别名中包含发件人地址</div>
                <div class="mb-3">
                  如果启用此选项，新的反向别名将包含发件人地址（例如 <span class="italic">sender_domain_com_gibberish@yuanyoupush.com</span>）
                  这样您就可以快速知道发件人。
                  <br />
                  如果禁用，将随机生成新的反向别名。
                  请注意，现有的反向别名不会改变。
                </div>
                <form method="post" action="#sender-in-ra">
                  {{ csrf_form.csrf_token }}
                  <input type="hidden" name="form-name" value="sender-in-ra">
                  <div class="form-check">
                    <input type="checkbox" id="include-sender-ra" name="enable"
                      {#                   todo: remove current_user.include_sender_in_reverse_alias is none condition #}
                      {% if current_user.include_sender_in_reverse_alias is none or current_user.include_sender_in_reverse_alias %}

                        checked {% endif %} class="form-check-input">
                        <label for="include-sender-ra">在反向别名中包含发件人地址</label>
                      </div>
                      <button type="submit" class="btn btn-outline-primary">保存</button>
                    </form>
                  </div>
                </div>
                <!-- END Reverse-alias -->
                <!-- Always expand alias info -->
                <div class="card" id="expand-alias-info-section">
                  <div class="card-body">
                    <div class="card-title">始终展开别名信息</div>
                    <div class="mb-3">
                      默认情况下，单击“更多”按钮后会显示附加别名信息。
                      <br />
                      当启用此选项时，别名附加信息将始终显示。
                      <br />
                    </div>
                    <form method="post" action="#expand-alias-info-section">
                      {{ csrf_form.csrf_token }}
                      <input type="hidden" name="form-name" value="expand-alias-info">
                      <div class="form-check">
                        <input type="checkbox" id="expand-alias-info" name="enable" {% if current_user.expand_alias_info %}checked{% endif %} class="form-check-input">
                          <label for="expand-alias-info">自动扩展别名信息</label>
                        </div>
                        <button type="submit" class="btn btn-outline-primary">保存</button>
                      </form>
                    </div>
                  </div>
                  <!-- END Always expand alias info -->
                  <!-- Include website address in alias -->
                  <div class="card" id="include_website_in_one_click_alias">
                    <div class="card-body">
                      <div class="card-title">在浏览器扩展程序的一键创建别名中包含网站地址</div>
                      <div class="mb-3">
                        如果启用，当您通过 原邮邮箱 浏览器扩展程序通过电子邮件输入字段创建别名时，网站名称将用作别名前缀
                        <br />
                        <img src="https://simplelogin.io/images/one-click-alias.gif"
                             class="my-2"
                             style="max-width: 40%">
                      </div>
                      <form method="post" action="#include_website_in_one_click_alias">
                        {{ csrf_form.csrf_token }}
                        <input type="hidden"
                               name="form-name"
                               value="include_website_in_one_click_alias">
                        <div class="form-check">
                          <input type="checkbox" id="include-website-in-alias" name="enable" {% if current_user.include_website_in_one_click_alias %}checked{% endif %} class="form-check-input">
                            <label for="include-website-in-alias">在别名中包含网站地址</label>
                          </div>
                          <button type="submit" class="btn btn-outline-primary">保存</button>
                        </form>
                      </div>
                    </div>
                    <!-- END Include website address in alias -->
                    <!-- Ignore Loop Email -->
                    {#    <div class="card" id="ignore-loop-email-section">#}
                    {#      <div class="card-body">#}
                    {#        <div class="card-title">Ignore Loop Emails</div>#}
                    {#        <div class="mb-3">#}
                    {#          On some email clients, "Reply All" automatically includes your alias that#}
                    {#          would send the same email to your mailbox.#}
                    {#          <br />#}
                    {#          You can disable these "loop" emails by enabling this option.#}
                    {#        </div>#}
                    {#        <form method="post" action="#ignore-loop-email-section">#}
                    {#         {{ csrf_form.csrf_token }} #}
                    {#          <input type="hidden" name="form-name" value="ignore-loop-email">#}
                    {#          <div class="form-check">#}
                    {#            <input type="checkbox" id="ignore-loop-email" name="enable"#}
                    {#                {% if current_user.ignore_loop_email %}checked{% endif %} class="form-check-input">#}
                    {#            <label for="ignore-loop-email">Ignore Loop Emails</label>#}
                    {#          </div>#}
                    {#          <button type="submit" class="btn btn-outline-primary">Update</button>#}
                    {#        </form>#}
                    {#      </div>#}
                    {#    </div>#}
                    <!-- END Ignore Loop Email -->
                    <div class="card">
                      <div class="card-body">
                        <div class="card-title">隔离和退信</div>
                        <div class="mb-3">
                          当您的邮箱提供商拒绝（或退回）电子邮件或将其标记为<i>钓鱼程序</i>时，
                          <br />
                          原邮邮箱 会保留此电子邮件的副本 7 天，以便您查看其内容并采取适当的措施。
                          <br />
                          电子邮件将在 7 天内删除。
                          这是 原邮邮箱 临时存储电子邮件的例外情况。
                        </div>
                        <a href="{{ url_for("dashboard.refused_email_route") }}"
                           class="btn btn-outline-primary">查看隔离和退信的电子邮件</a>
                      </div>
                    </div>
                    <div class="card" id="blocked-behaviour">
                      <div class="card-body">
                        <div class="card-title">禁用别名/阻止联系人</div>
                        <div class="mb-3">
                          当电子邮件被发送到<b>已禁用</b>的别名或从<b>已阻止</b>的联系人发送时，您可以决定发件人应该看到什么响应。
                          <br />
                          <b>忽略</b>意味着他们将看到已发送的消息，但 原邮邮箱 实际上不会将其转发给您。
                          <br />
                          这是默认选项，因为您可以通过重新启用别名或取消阻止联系人来再次开始接收电子邮件。
                          <br />
                          <b>拒绝</b>意味着 原邮邮箱 将告诉他们别名不存在。
                          <br />
                        </div>
                        <form method="post" action="#blocked-behaviour" class="form-inline">
                          {{ csrf_form.csrf_token }}
                          <input type="hidden" name="form-name" value="change-blocked-behaviour">
                          <select class="form-control mr-sm-2" name="blocked-behaviour">
                            <option value="{{ BlockBehaviourEnum.return_2xx.value }}" {% if current_user.block_behaviour.value == BlockBehaviourEnum.return_2xx.value %}selected="selected"{% endif %}>忽略（发件人将看到电子邮件已送达，但您不会收到任何内容）。</option>
                            <option value="{{ BlockBehaviourEnum.return_5xx.value }}" {% if current_user.block_behaviour.value == BlockBehaviourEnum.return_5xx.value %}selected="selected"{% endif %}>拒绝（发件人将被告知您的别名不存在）。</option>
                          </select>
                          <button class="btn btn-outline-primary">保存</button>
                        </form>
                      </div>
                    </div>
                    <div class="card" id="sender-header">
                      <div class="card-body">
                        <div class="card-title">在电子邮件标题中包含原始发件人</div>
                        <div class="mb-3">
                          原邮邮箱 会从 <b>反向别名</b> 转发电子邮件到您的邮箱，而不是从 <b>真实的</b>
                          发件人地址转发。
                          <br />
                          如果启用此选项，则原始发件人地址将存储在电子邮件标头 <b>X-SimpleLogin-Envelope-From</b>中，
                          <br />
                          而原始发​​件人标头将存储在 <b>X-SimpleLogin-Original-From</b> 中。
                          您可以选择在您的电子邮件客户端中显示此标头。
                          <br />
                          由于电子邮件标头未加密，您的邮箱服务可以通过此标头了解发件人地址。
                        </div>
                        <form method="post" action="#sender-header">
                          {{ csrf_form.csrf_token }}
                          <input type="hidden" name="form-name" value="sender-header">
                          <div class="form-check">
                            <input type="checkbox" id="include-sender-header" name="enable" {% if current_user.include_header_email_header %}checked{% endif %} class="form-check-input">
                              <label for="include-sender-header">在电子邮件标题中包含发件人地址</label>
                            </div>
                            <button type="submit" class="btn btn-outline-primary">保存</button>
                          </form>
                        </div>
                      </div>
                      <!-- Alias import/export -->
                      <div class="card">
                        <div class="card-body">
                          <div class="card-title">别名 导入/导出</div>
                          <div class="mb-3">
                            您可以将在其他平台上创建的别名导入 原邮邮箱
                            您还可以将别名导出为可读的 csv 格式，以便将来批量导入。
                          </div>
                          <a href="{{ url_for("dashboard.batch_import_route") }}"
                             class="btn btn-outline-primary mr-2">批量导入</a>
                          <a href="{{ url_for("dashboard.alias_export_route") }}"
                             class="btn btn-outline-secondary">导出别名</a>
                        </div>
                      </div>
                      <!-- END Alias import/export -->
                    </div>
                  {% endblock %}
                  {% block script %}
                    <script>
                    {# let anchor = window.location.hash;
                    $(anchor).addClass("highlighted") #}
</script>
{% endblock %}
