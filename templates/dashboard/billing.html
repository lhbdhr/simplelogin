{% extends "default.html" %}

{% block title %}账单{% endblock %}
{% block head %}{% endblock %}
{% block default_content %}

  <div class="card">
    <div class="card-body">
      <h1 class="h3 mb-5">账单</h1>
      {% if sub.cancelled %}

        <p>
         您使用的是 <b>{{ sub.plan_name() }}</b> 计划。
        <br />
        您已取消订阅，订阅将于 {{ sub.next_bill_date.strftime("%Y-%m-%d") }} 结束
        </p>
        <p class="alert alert-info">
          如果您改变主意，您可以再次订阅 原邮邮箱，但
          请注意，这将是一个完全
          新的订阅，并且
          您的付款方式将<b>立即</b>扣款。
          <br />
          当前订阅的剩余期限不予考虑。
          <br />
          <a href="{{ url_for("dashboard.pricing") }}"
             class="btn btn-primary mt-2">重新订阅</a>
        </p>
      {% else %}
        <p>
          您使用的是 <b>{{ sub.plan_name() }}</b> 计划。非常感谢您支持原邮邮箱。🙌
          <br />
          下一个计费周期开始于 {{ sub.next_bill_date.strftime("%Y-%m-%d") }}.
        </p>
        <div class="mt-3">
          单击此处更新我们的付款合作伙伴 Paddle 的账单信息：
          <br />
          <a class="btn btn-outline-success mt-2" href="{{ sub.update_url }}">更新帐单信息</a>
        </div>
        <hr />
        <div class="mt-6">
          <h4>变更计划</h4>
          您可以随时更改计划。
          <br />
          请注意，新的计费周期立即开始
          即，当您从月度计划切换或反之亦然时，您将<b>立即</b>支付年费（$36）
          <b>无需按比例计算</b>。
          <br />
          要更改计划，您也可以在<b>计划结束</b>前取消当前计划并订阅新计划。
          {% if sub.plan == PlanEnum.yearly %}

            <form method="post"
                  onsubmit="return confirm('这将更改您当前的订阅计划，请确认');">
              <input type="hidden" name="form-name" value="change-monthly">
              <button class="btn btn-outline-primary mt-2">更改为月度计划</button>
            </form>
          {% else %}
            <form method="post"
                  onsubmit="return confirm('这将更改您当前的订阅计划，请确认');">
              <input type="hidden" name="form-name" value="change-yearly">
              <button class="btn btn-outline-primary mt-2">更改为年度计划</button>
            </form>
          {% endif %}
        </div>
        <hr />
        <div>
          <h4>取消订阅</h4>
          不想再保护您的收件邮箱了吗？
          <br />
          <form method="post">
            <input type="hidden" name="form-name" value="cancel">
            <span class="cancel btn btn-outline-danger mt-2">
              取消订阅 <i class="fe fe-alert-triangle text-danger"></i>
            </span>
          </form>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
{% block script %}

  <script>
    $(".cancel").on("click", function (e) {
      let that = $(this);

      bootbox.confirm({
        message: "此操作不可逆，请确认。",
        buttons: {
          confirm: {
            label: '取消订阅',
            className: 'btn-danger'
          },
          cancel: {
            label: '关闭',
            className: 'btn-outline-primary'
          }
        },
        callback: function (result) {
          if (result) {
            that.closest("form").submit();
          }
        }
      })
    });

  </script>
{% endblock %}
