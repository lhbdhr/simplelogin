{% extends "default.html" %}

{% set active_page = "setting" %}
{% block title %}设置{% endblock %}
{% block head %}

  <style>
        .card-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 3px;
        }
        .highlighted{
            border: solid 2px #5675E2;
        }
        li {
            margin-top: 8px;
        }

  </style>
{% endblock %}
{% block default_content %}

  <div class="col pb-3">
    <!-- Change email -->
    <div class="card">
      <div class="card-body">
        <form method="post" enctype="multipart/form-data">
          <input type="hidden" name="form-name" value="update-email">
          {{ change_email_form.csrf_token }}
          <div class="card-title">登陆账户</div>
          <div class="mb-3">
            此电子邮件地址用于登录 原邮邮箱 。
            <br />
            如果您想要更改电子邮件转发到的邮箱，请使用
            <a href="{{ url_for("dashboard.mailbox_route") }}">
              <i class="fe fe-inbox"></i> 收件邮箱
            </a>
            替代.
          </div>
          <div class="form-group mt-2">
            <!-- Not allow user to change email if there's a pending change -->
            {{ change_email_form.email(class="form-control", value=current_user.email, readonly=pending_email != None) }}
            {{ render_field_errors(change_email_form.email) }}
          </div>
          <button class="btn btn-outline-primary">修改登陆邮箱</button>
        </form>
        {% if pending_email %}

          <div class="mt-2">
            <span class="text-danger float-left">待处理的电子邮件更改： {{ pending_email }}</span>
            <form method="POST"
                  action="{{ url_for("dashboard.resend_email_change") }}"
                  class="float-left ml-2">
              {{ change_email_form.csrf_token }}
              <a onclick="this.closest('form').submit()"
                 class="btn btn-secondary btn-sm">重新发送验证邮件</a>
            </form>
            <form method="POST"
                  action="{{ url_for("dashboard.cancel_email_change") }}"
                  class="float-left ml-2">
              {{ change_email_form.csrf_token }}
              <a onclick="this.closest('form').submit()"
                 class="btn btn-secondary btn-sm">取消登陆邮箱更改</a>
            </form>
          </div>
        {% endif %}
      </div>
    </div>
    <!-- END Change email -->
    <!-- Change password -->
    <div class="card" id="change_password">
      <div class="card-body">
        <div class="card-title">密码</div>
        <div class="mb-3">您将收到一封电子邮件，其中包含有关如何更改密码的说明。</div>
        <form method="post">
          {{ csrf_form.csrf_token }}
          <input type="hidden" name="form-name" value="change-password">
          <button class="btn btn-outline-primary">发送修改密码的电子邮件</button>
        </form>
      </div>
    </div>
    <!-- END Change password -->
    <!-- TOTP -->
    <div class="card" id="totp">
      <div class="card-body">
        <div class="card-title">两步验证</div>
        <div class="mb-3">
          使用 2FA 保护您的帐户，登录时系统会要求您输入通过应用程序生成的代码。
          <br />
        </div>
        {% if not current_user.enable_otp %}

          <a href="{{ url_for("dashboard.mfa_setup") }}"
             class="btn btn-outline-primary">设置两步验证</a>
        {% else %}
          <a href="{{ url_for("dashboard.mfa_cancel") }}"
             class="btn btn-outline-danger">禁用两步验证</a>
        {% endif %}
      </div>
    </div>
    <!-- END TOTP -->
    <!-- WebAuthn -->
    <div class="card">
      <div class="card-body">
        <div class="card-title">安全密钥 (WebAuthn)</div>
        <div class="mb-3">您可以通过将 FIDO 支持的物理密钥（例如 Yubikey、Google Titan 或具有适当硬件的设备）链接到您的帐户来保护您的帐户。</div>
        {% if current_user.fido_uuid is none %}

          <a href="{{ url_for("dashboard.fido_setup") }}"
             class="btn btn-outline-primary">设置安全密钥</a>
        {% else %}
          <a href="{{ url_for("dashboard.fido_manage") }}"
             class="btn btn-outline-info">管理安全密钥</a>
        {% endif %}
      </div>
    </div>
    <!-- END WebAuthn -->
    <!-- data export -->
    <div class="card">
      <div class="card-body">
        <div class="card-title">原邮邮箱数据导出</div>
        <div class="mb-3">
          根据 GDPR（通用数据保护条例）法律，您可以请求一份存储在 原邮邮箱 上的数据副本。
          <br />
          包含所有信息的 zip 文件将发送到您的 原邮邮箱 帐户地址。
        </div>
        <div class="d-flex">
          <div>
            <form method="post">
              {{ csrf_form.csrf_token }}
              <input type="hidden" name="form-name" value="send-full-user-report">
              <button class="btn btn-outline-info">导出您的数据</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- END data export -->
    <!-- Delete account -->
    <div class="card">
      <div class="card-body">
        <div class="card-title">删除账户</div>
        <div class="mb-3">如果 原邮邮箱 不适合您，您可以直接删除您的帐户。</div>
        <a href="{{ url_for("dashboard.delete_account") }}"
           class="btn btn-outline-danger">删除账户</a>
      </div>
    </div>
    <!-- END Delete account -->
  </div>
{% endblock %}
{% block script %}

  <script>
        let anchor = window.location.hash;
        $(anchor).addClass("highlighted")


  </script>
{% endblock %}
