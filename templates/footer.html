<!-- ========== FOOTER ========== -->
<footer class="footer">
  <div class="container">
    <div class="row align-items-center flex-row-reverse">
      <div class="col-sm-12 col-md-auto">
        <div class="row align-items-center">
          <div class="col-sm-12 col-md-auto">
            <ul class="list-inline list-inline-dots mb-0">
              <li class="list-inline-item">
                <a href="https://addons.mozilla.org/firefox/addon/simplelogin/"
                   target="_blank"
                   rel="noopener">
                  Firefox 浏览器插件<i class="fe fe-external-link"></i>
                </a>
              </li>
              <li class="list-inline-item" data-intro="您可以使用<em>浏览器插件</em>.
                <br />
                <br />
                浏览器插件可以帮助您，<em>无需登陆到 原邮网站 即可创建和管理别名</em>。
                <br />
                <br />
                " data-step="5">
                <a href="https://chrome.google.com/webstore/detail/dphilobhebphkdjbpfohgikllaljmgbn"
                   target="_blank"
                   rel="noopener">
                  Chrome 浏览器插件<i class="fe fe-external-link"></i>
                </a>
              </li>
              {# <li class="list-inline-item"><a href="mailto:{{SUPPORT_EMAIL}}">联系我们
                <i class="fe fe-external-link"></i></a></li> #}
              <li class="list-inline-item">
                <a href="https://t.me/yuanyou_official" target="_blank">联系我们
                  <i class="fe fe-external-link"></i></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-auto col-sm-12 mt-3 mt-md-0 flex-fill text-center text-sm-left">
        © {{ YEAR }}
        <a href="{{ LANDING_PAGE_URL }}" target="_blank" rel="noopener">原邮邮箱</a>.
      </div>
    </div>
  </div>
</footer>
<!-- ========== END FOOTER ========== -->
<script>
  function startIntro() {
    introJs().setOptions({'showProgress': true, 'nextLabel': '下一步 →', 'prevLabel': '← 上一步', 'doneLabel': '完成', 'skipLabel': '跳过'}).start();
  }
</script>
<script src="{{ url_for('static', filename='node_modules/vue/dist/vue.min.js') }}"></script>
<script>
  var app = new Vue({
    el: '#notification-app',
    delimiters: ["[[", "]]"], // necessary to avoid conflict with jinja
    data: {
      notifications: [],
      page: 0,
      loading: true,
      canLoadMore: false,
      showNotification: false,
    },
    computed: {
      has_non_read_notification: function () {
        for (let i = 0; i < this.notifications.length; i++) {
          if (!this.notifications[i].read) return true;
        }
        return false;
      }
    },
    methods: {
      markAsRead: async function (notification) {
        notification.read = true;
        let res = await fetch(`/api/notifications/${notification.id}/read`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            '{{HEADER_ALLOW_API_COOKIES}}': 'allow'
          }
        });

        if (!res.ok) {
          toastr.error("抱歉造成不便！您可以刷新页面并重试吗？", "未知错误");
        }
      },

      loadMore: async function () {
        let that = this;
        that.page += 1;

        let res = await fetch(`/api/notifications?page=${that.page}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
            '{{HEADER_ALLOW_API_COOKIES}}': 'allow'
          }
        });
        if (res.ok) {
          let json = await res.json();
          that.canLoadMore = json.more;
          that.notifications = that.notifications.concat(json.notifications);
        }
      }

    },
    async mounted() {
      Object.freeze(Object.prototype);
      let that = this;
      let res = await fetch(`/api/notifications?page=${that.page}`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          '{{HEADER_ALLOW_API_COOKIES}}': 'allow'
        }
      });
      if (res.ok) {
        let json = await res.json();
        that.notifications = json.notifications;
        that.loading = false;
        that.canLoadMore = json.more
        if (that.notifications.length > 0)
          that.showNotification = true;
      }
    }
  })
</script>
<script>

  const url = new URL(window.location.href);
  let showIntro = url.searchParams.get('showIntro');
  if (showIntro) {
    startIntro();
  }
</script>
