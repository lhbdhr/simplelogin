<footer class="footer">
  <div class="container">
    <div class="row align-items-center flex-row-reverse">
      <div class="col-auto ml-lg-auto">
        <div class="row align-items-center">
          <div class="col-auto">
            <ul class="list-inline list-inline-dots mb-0">
              <li class="list-inline-item">PoweredBy <a href="https://github.com/simple-login/app" target="_blank" rel="noopener">
                SimpleLogin<i class="fe fe-external-link"></i>
              </a></li>
              <li class="list-inline-item"><a href="mailto:{{SUPPORT_EMAIL}}">Contact Us
                <i class="fe fe-external-link"></i></a></li>
              <li class="list-inline-item intro-step-0">
                <a onclick="startIntro()"
                   data-intro="æ¬¢è¿ä½¿ç”¨ åŸé‚®é‚®ç®±ï¼<br><br>
                   ä¼¼ä¹è¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡æ¥è¿™é‡Œï¼Œ
                   è®©æˆ‘ä»¬ä¸€èµ·äº†è§£ä¸€äº› åŸé‚®é‚®ç®± åŠŸèƒ½ï¼<br><br>
                   æ‚¨å¯ä»¥éšæ—¶é€šè¿‡å•å‡»ä¸‹é¢çš„ <i class='fe fe-help-circle'></i> å›¾æ ‡å†æ¬¡æ˜¾ç¤ºæœ¬æ•™ç¨‹ğŸ‘‡"
                   data-step="1"
                ><i class="fe fe-help-circle"></i></a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-auto mt-3 mt-lg-0 text-center">
        Â© {{ YEAR }}
        <a href="https://app.yuanyou.de" target="_blank" rel="noopener">åŸé‚®é‚®ç®±</a>.
      </div>
    </div>
  </div>
</footer>

<script>
  function startIntro() {
    introJs().setOption('showProgress', true).start();
    introJs().start();
  }
</script>

<script src="{{ url_for('static', filename='node_modules/vue/dist/vue.min.js') }}"></script>

<script>
  var app = new Vue({
    el: '#notification-app',
    delimiters: ["[[", "]]"], // necessary to avoid conflict with jinja
    data: {
      notifications: [],
      page: 0,
      loading: true,
      canLoadMore: false,
      showNotification: false,
    },
    computed: {
      has_non_read_notification: function () {
        for (let i = 0; i < this.notifications.length; i++) {
          if (!this.notifications[i].read) return true;
        }
        return false;
      }
    },
    methods: {
      markAsRead: async function (notification) {
        notification.read = true;
        let res = await fetch(`/api/notifications/${notification.id}/read`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          }
        });

        if (!res.ok) {
          toastr.error("æŠ±æ­‰é€ æˆä¸ä¾¿ï¼æ‚¨å¯ä»¥åˆ·æ–°é¡µé¢å¹¶é‡è¯•å—ï¼Ÿ", "æœªçŸ¥é”™è¯¯");
        }
      },

      loadMore: async function () {
        let that = this;
        that.page += 1;

        let res = await fetch(`/api/notifications?page=${that.page}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          }
        });
        if (res.ok) {
          let json = await res.json();
          that.canLoadMore = json.more;
          that.notifications = that.notifications.concat(json.notifications);
        }
      }

    },
    async mounted() {
      let that = this;
      let res = await fetch(`/api/notifications?page=${that.page}`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        }
      });
      if (res.ok) {
        let json = await res.json();
        that.notifications = json.notifications;
        that.loading = false;
        that.canLoadMore = json.more
        if (that.notifications.length > 0)
          that.showNotification = true;
      }
    }
  })
</script>
