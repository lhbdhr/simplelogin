{% extends 'dashboard/domain_detail/base.html' %} {% set domain_detail_page =
"dns" %} {% block title %} {{ custom_domain.domain }} DNS {% endblock %} {%
block domain_detail_content %}
<div
  class="p-4 mr-auto"
  style="max-width: 60rem"
>
  <h1 class="h2">{{ custom_domain.domain }}</h1>
  <div class="">è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è®¾ç½®æ‚¨çš„åŸŸåã€‚</div>

  <div class="small-text mb-5">
    DNS æ›´æ”¹å¯èƒ½éœ€è¦é•¿è¾¾ 24
    å°æ—¶æ‰èƒ½ç”Ÿæ•ˆã€‚ä½†å®é™…ä¸Šï¼Œå®ƒè¦å¿«å¾—å¤šï¼ˆæ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œå¤§çº¦ 1 åˆ†é’Ÿï¼‰ã€‚
  </div>

  <div id="mx-form">
    <div class="font-weight-bold">
      1. MX è®°å½• {% if custom_domain.verified %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="MX è®°å½•å·²é€šè¿‡éªŒè¯"
      >
        âœ…
      </span>
      {% else %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="MX è®°å½•æœªé€šè¿‡éªŒè¯"
      >
        ğŸš«
      </span>
      {% endif %}
    </div>

    <div class="mb-2">
      å°†ä»¥ä¸‹ MX DNS è®°å½•æ·»åŠ åˆ°æ‚¨çš„åŸŸã€‚
      <br />
      è¯·æ³¨æ„ï¼Œç›®æ ‡åœ°å€æœ«å°¾æœ‰ä¸€ä¸ªç‚¹ (
      <em>.</em>
      )ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿ä½¿ç”¨
      <i>ç»å¯¹</i>
      åœ°å€ã€‚
      <br />
      æ­¤å¤–ï¼Œä¸€äº›åŸŸåæ³¨å†Œå•†ï¼ˆNamecheapã€CloudFlare ç­‰ï¼‰å¯èƒ½ä¼šä½¿ç”¨
      <em>@</em>
      ä½œä¸ºæ ¹åŸŸã€‚
    </div>

    {% for priority, email_server in EMAIL_SERVERS_WITH_PRIORITY %}
    <div class="mb-3 p-3 dns-record">
      è®°å½•ç±»å‹: MX
      <br />
      åŸŸå: {{ custom_domain.domain }} æˆ–è€…
      <em
        data-toggle="tooltip"
        title="ç‚¹å‡»å¤åˆ¶"
        class="clipboard"
        data-clipboard-text="@"
      >
        @
      </em>
      <br />
      ä¼˜å…ˆçº§: {{ priority }}
      <br />
      å€¼:
      <em
        data-toggle="tooltip"
        title="ç‚¹å‡»å¤åˆ¶"
        class="clipboard"
        data-clipboard-text="{{ email_server }}"
      >
        {{ email_server }}
      </em>
    </div>
    {% endfor %}

    <form
      method="post"
      action="#mx-form"
    >
      <input
        type="hidden"
        name="form-name"
        value="check-mx"
      />
      {% if custom_domain.verified %}
      <button
        type="submit"
        class="btn btn-outline-primary"
      >
        é‡æ–°éªŒè¯
      </button>
      {% else %}
      <button
        type="submit"
        class="btn btn-primary"
      >
        éªŒè¯
      </button>
      {% endif %}
    </form>

    {% if not mx_ok %}
    <div class="text-danger mt-4">
      æ‚¨çš„ DNS è®¾ç½®ä¸æ­£ç¡®ã€‚æˆ‘ä»¬è·å–çš„ MX è®°å½•æ˜¯ï¼š
      <div class="mb-3 p-3 dns-record">
        {% if not mx_errors %} (Empty) {% endif %} {% for r in mx_errors %} {{ r
        }}
        <br />
        {% endfor %}
      </div>
      {% if custom_domain.verified %}
      <div class="alert alert-danger">
        å¦‚æœæœªæ­£ç¡®è®¾ç½® MX è®°å½•ï¼Œæ‚¨å¯èƒ½ä¼šé”™è¿‡å‘é€è‡³æ‚¨çš„
        åˆ«åçš„ç”µå­é‚®ä»¶ã€‚è¯·å°½å¿«æ›´æ–° MX è®°å½•ã€‚
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>

  <hr />

  <div id="spf-form">
    <div class="font-weight-bold">
      2. SPF (å¯é€‰é¡¹) {% if custom_domain.spf_verified %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="SPF å·²é€šè¿‡éªŒè¯"
      >
        âœ…
      </span>
      {% else %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="SPF æœªé€šè¿‡éªŒè¯"
      >
        ğŸš«
      </span>
      {% endif %}
    </div>

    <div>
      SPF
      <a
        href="https://en.wikipedia.org/wiki/Sender_Policy_Framework"
        target="_blank"
        rel="noopener"
      >
        (Wikipediaâ†—)
      </a>
      æ˜¯ä¸€ç§ç”µå­é‚®ä»¶èº«ä»½éªŒè¯æ–¹æ³•ï¼Œæ—¨åœ¨åœ¨ç”µå­é‚®ä»¶ä¼ é€’è¿‡ç¨‹ä¸­æ£€æµ‹ä¼ªé€ çš„å‘ä»¶äººåœ°å€ã€‚
      <br />
      å¼ºçƒˆå»ºè®®è®¾ç½® SPFï¼Œä»¥å‡å°‘æ‚¨çš„ç”µå­é‚®ä»¶æœ€ç»ˆè¿›å…¥æ”¶ä»¶äººåƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹çš„æœºä¼šã€‚
    </div>

    <div class="mb-2">å°†ä»¥ä¸‹ TXT DNS è®°å½•æ·»åŠ åˆ°æ‚¨çš„åŸŸã€‚</div>

    <div class="mb-2 p-3 dns-record">
      è®°å½•ç±»å‹: TXT
      <br />
      åŸŸå: {{ custom_domain.domain }} æˆ–è€…
      <em
        data-toggle="tooltip"
        title="ç‚¹å‡»å¤åˆ¶"
        class="clipboard"
        data-clipboard-text="@"
      >
        @
      </em>
      <br />
      å€¼:
      <em
        data-toggle="tooltip"
        title="ç‚¹å‡»å¤åˆ¶"
        class="clipboard"
        data-clipboard-text="{{ spf_record }}"
      >
        {{ spf_record }}
      </em>
    </div>

    <form
      method="post"
      action="#spf-form"
    >
      <input
        type="hidden"
        name="form-name"
        value="check-spf"
      />
      {% if custom_domain.spf_verified %}
      <button
        type="submit"
        class="btn btn-outline-primary"
      >
        é‡æ–°éªŒè¯
      </button>
      {% else %}
      <button
        type="submit"
        class="btn btn-primary"
      >
        éªŒè¯
      </button>
      {% endif %}
    </form>

    {% if not spf_ok %}
    <div class="text-danger mt-4">
      æ‚¨çš„ DNS è®¾ç½®ä¸æ­£ç¡®ã€‚æˆ‘ä»¬è·å–çš„ TXT è®°å½•æ˜¯ï¼š
      <div class="mb-3 p-3 dns-record">
        {% if not spf_errors %} (Empty) {% endif %} {% for r in spf_errors %} {{
        r }}
        <br />
        {% endfor %}
      </div>
      {% if custom_domain.spf_verified %} å¦‚æœæ²¡æœ‰è®¾ç½®
      SPFï¼Œæ‚¨ä»åˆ«åå‘é€çš„ç”µå­é‚®ä»¶å¯èƒ½ä¼šè¢«å½’å…¥åƒåœ¾é‚®ä»¶/åƒåœ¾æ–‡ä»¶å¤¹ã€‚ {% endif %}
    </div>
    {% endif %}
  </div>

  <hr />

  <div id="dkim-form">
    <div class="font-weight-bold">
      3. DKIM (å¯é€‰) {% if custom_domain.dkim_verified %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="SPF å·²é€šè¿‡éªŒè¯"
      >
        âœ…
      </span>
      {% else %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="DKIM æœªé€šè¿‡éªŒè¯"
      >
        ğŸš«
      </span>
      {% endif %}
    </div>

    <div>
      DKIM
      <a
        href="https://en.wikipedia.org/wiki/DomainKeys_Identified_Mail"
        target="_blank"
        rel="noopener"
      >
        (Wikipediaâ†—)
      </a>
      æ˜¯ä¸€ç§æ—¨åœ¨é¿å…ç”µå­é‚®ä»¶æ¬ºéª—çš„ç”µå­é‚®ä»¶èº«ä»½éªŒè¯æ–¹æ³•ã€‚
      <br />
      å¼ºçƒˆå»ºè®®è®¾ç½® DKIMï¼Œä»¥å‡å°‘æ‚¨çš„ç”µå­é‚®ä»¶ æœ€ç»ˆè¿›å…¥æ”¶ä»¶äººåƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹çš„æœºä¼šã€‚
    </div>

    <div class="mb-2">å°†ä»¥ä¸‹ CNAME DNS è®°å½•æ·»åŠ åˆ°æ‚¨çš„åŸŸã€‚</div>

    <div class="mb-2 p-3 dns-record">
      è®°å½•ç±»å‹: CNAME
      <br />
      åŸŸå:
      <em
        data-toggle="tooltip"
        title="ç‚¹å‡»å¤åˆ¶"
        class="clipboard"
        data-clipboard-text="dkim._domainkey"
      >
        dkim._domainkey
      </em>
      <br />
      å€¼:
      <em
        data-toggle="tooltip"
        title="ç‚¹å‡»å¤åˆ¶"
        class="clipboard"
        data-clipboard-text="{{ dkim_cname + '.' }}"
        style="overflow-wrap: break-word"
      >
        {{ dkim_cname }}.
      </em>
    </div>

    <div class="alert alert-info">
      æŸäº› DNS æ³¨å†Œå•†å¯èƒ½éœ€è¦å®Œæ•´çš„è®°å½•è·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·
      æ”¹ç”¨
      <i>dkim._domainkey.{{ custom_domain.domain }}
      ä½œä¸ºåŸŸå€¼ã€‚
      <br />
      å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å­åŸŸï¼Œä¾‹å¦‚
      <i>subdomain.domain.com</i>
      ï¼Œåˆ™éœ€è¦æ”¹ç”¨
      <i>dkim._domainkey.subdomain</i>
      ä½œä¸ºåŸŸå€¼ã€‚
      <br />
    </div>
    <div class="alert alert-info">
      å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ CloudFlareï¼Œè¯·ç¡®ä¿
      <b>ä¸è¦</b>
      å¼€å¯ä»£ç†é€‰é¡¹ã€‚
      <br />
      <br />
      <img
        src="/static/images/cloudflare-proxy.png"
        class="w-100"
      />
    </div>

    <form
      method="post"
      action="#dkim-form"
    >
      <input
        type="hidden"
        name="form-name"
        value="check-dkim"
      />
      {% if custom_domain.dkim_verified %}
      <button
        type="submit"
        class="btn btn-outline-primary"
      >
        é‡æ–°éªŒè¯
      </button>
      {% else %}
      <button
        type="submit"
        class="btn btn-primary"
      >
        éªŒè¯
      </button>
      {% endif %}
    </form>

    {% if not dkim_ok %}
    <div class="text-danger mt-4">
      æ‚¨çš„ DNS è®¾ç½®ä¸æ­£ç¡®ã€‚{% if dkim_errors %} æˆ‘ä»¬ä¸º
      <em>dkim._domainkey.{{ custom_domain.domain }}</em>
      è·å–çš„ CNAME è®°å½•æ˜¯ï¼š
      <div class="mb-3 p-3 dns-record">
        {% for r in dkim_errors %} {{ r }}
        <br />
        {% endfor %}
      </div>
      {% endif %} 
      {% if custom_domain.dkim_verified %} 
      å¦‚æœæ²¡æœ‰è®¾ç½® DKIMï¼Œæ‚¨ä»åˆ«åå‘é€çš„ç”µå­é‚®ä»¶å¯èƒ½ä¼šè¢«å½’å…¥åƒåœ¾é‚®ä»¶/åƒåœ¾æ–‡ä»¶å¤¹ã€‚
      {% endif %}
    </div>
    {% endif %}
  </div>

  <hr />

  <div id="dmarc-form">
    <div class="font-weight-bold">
      4. DMARC (å¯é€‰) {% if custom_domain.dmarc_verified %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="DMARC å·²é€šè¿‡éªŒè¯"
      >
        âœ…
      </span>
      {% else %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="DMARC æœªé€šè¿‡éªŒè¯"
      >
        ğŸš«
      </span>
      {% endif %}
    </div>

    <div>
      DMARC
      <a
        href="https://en.wikipedia.org/wiki/DMARC"
        target="_blank"
        rel="noopener"
      >
        (Wikipediaâ†—)
      </a>
      æ—¨åœ¨ä¿æŠ¤åŸŸåå…é­æœªç»æˆæƒçš„ä½¿ç”¨ï¼Œä¿—ç§°
      ç”µå­é‚®ä»¶æ¬ºéª—ã€‚
      <br />
      DMARC ç­–ç•¥ä»¥ SPF å’Œ DKIM ä¸ºåŸºç¡€ï¼Œå¯å‘ŠçŸ¥æ¥æ”¶é‚®ä»¶æœåŠ¡å™¨
      å¦‚æœè¿™ä¸¤ç§èº«ä»½éªŒè¯æ–¹æ³•å‡æœªé€šè¿‡ï¼Œè¯¥å¦‚ä½•å¤„ç†ã€‚
    </div>

    <div class="mb-2">å°†ä»¥ä¸‹ TXT DNS è®°å½•æ·»åŠ åˆ°æ‚¨çš„åŸŸã€‚</div>

    <div class="mb-2 p-3 dns-record">
      è®°å½•ç±»å‹: TXT
      <br />
      åŸŸå:
      <em
        data-toggle="tooltip"
        title="ç‚¹å‡»å¤åˆ¶"
        class="clipboard"
        data-clipboard-text="_dmarc"
      >
        _dmarc
      </em>
      <br />
      å€¼:
      <em
        data-toggle="tooltip"
        title="ç‚¹å‡»å¤åˆ¶"
        class="clipboard"
        data-clipboard-text="{{ dmarc_record }}"
      >
        {{ dmarc_record }}
      </em>
    </div>

    <div class="alert alert-info">
      æŸäº› DNS æ³¨å†Œå•†å¯èƒ½éœ€è¦å®Œæ•´çš„è®°å½•è·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·
      æ”¹ç”¨
      <i>_dmarc.{{ custom_domain.domain }}</i>
      ä½œä¸ºåŸŸå€¼ã€‚
      <br />
      å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å­åŸŸï¼Œä¾‹å¦‚
      <i>subdomain.domain.com</i>
      ï¼Œåˆ™éœ€è¦æ”¹ç”¨
      <i>_dmarc.subdomain</i>
      ä½œä¸ºåŸŸå€¼ã€‚
      <br />
    </div>

    <form
      method="post"
      action="#dmarc-form"
    >
      <input
        type="hidden"
        name="form-name"
        value="check-dmarc"
      />
      {% if custom_domain.dmarc_verified %}
      <button
        type="submit"
        class="btn btn-outline-primary"
      >
        é‡æ–°éªŒè¯
      </button>
      {% else %}
      <button
        type="submit"
        class="btn btn-primary"
      >
        éªŒè¯
      </button>
      {% endif %}
    </form>

    {% if not dmarc_ok %}
    <div class="text-danger mt-4">
      æ‚¨çš„ DNS è®¾ç½®ä¸æ­£ç¡®ã€‚æˆ‘ä»¬è·å–çš„ TXT è®°å½•æ˜¯ï¼š
      <div
        class="mb-3 p-3"
        style="background-color: #eee"
      >
        {% if not dmarc_errors %} (Empty) {% endif %} {% for r in dmarc_errors
        %} {{ r }}
        <br />
        {% endfor %}
      </div>
      {% if custom_domain.dmarc_verified %} å¦‚æœæ²¡æœ‰è®¾ç½® DMARCï¼Œä»æ‚¨çš„åˆ«åå‘é€çš„ç”µå­é‚®ä»¶å¯èƒ½ä¼šè¢«å½’å…¥åƒåœ¾é‚®ä»¶/åƒåœ¾æ–‡ä»¶å¤¹ã€‚ {% endif %}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
