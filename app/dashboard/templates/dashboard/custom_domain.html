{% extends 'default.html' %}
{% set active_page = "custom_domain" %}

{% block title %}
  Custom Domains
{% endblock %}

{% block head %}
{% endblock %}

{% block default_content %}
  <div class="row">
    <div class="col">
      <h1 class="h3"> è‡ªå®šä¹‰åŸŸå
        <a class="ml-3 text-info" style="font-size: 12px" data-toggle="collapse" href="#howtouse" role="button"
           aria-expanded="false" aria-controls="collapseExample">
          å¦‚ä½•ä½¿ç”¨ <i class="fe fe-chevrons-down"></i>
        </a>
      </h1>

      {% if not current_user.is_premium() %}
        <div class="alert alert-danger" role="alert">
          æ­¤åŠŸèƒ½ä»…åœ¨é«˜çº§è®¡åˆ’ä¸­å¯ç”¨ã€‚
          <a href="{{URL}}/dashboard/pricing" target="_blank" rel="noopener">
            å‡çº§ä¸ºé«˜çº§è®¡åˆ’<i class="fe fe-external-link"></i>
          </a>
        </div>
      {% endif %}

      <div class="alert alert-primary collapse {% if not custom_domains %} show {% endif %}" id="howtouse" role="alert">
        é€šè¿‡æ·»åŠ æ‚¨çš„åŸŸåï¼Œæ‚¨å¯ä»¥åˆ›å»ºåˆ«åï¼Œä¾‹å¦‚ <b>hi@my-domain.com</b> <br>
        æ‚¨è¿˜å¯ä»¥å¯ç”¨ <b>catch-all</b> æ¥åŠ¨æ€åˆ›å»ºåˆ«åï¼š
        åªéœ€ä½¿ç”¨ <b>anything@my-domain.com</b>ï¼Œå®ƒå°±ä¼šåœ¨
        æ”¶åˆ°ç”µå­é‚®ä»¶æ—¶åˆ›å»ºã€‚
        <p>ï¼ï¼ï¼è‡ªå®šä¹‰åŸŸåˆ«åé‚®ç®±ä¸æ”¯æŒPUSH</p>
      </div>

      <div class="row">
        {% for custom_domain in custom_domains %}
          <div class="col-12 col-lg-6">
            <div class="card" style="">
              <div class="card-body">
                <h5 class="card-title">
                  <a href="{{ url_for('dashboard.domain_detail', custom_domain_id=custom_domain.id) }}">{{ custom_domain.domain }}</a>
                  {% if custom_domain.verified %}
                    <span class="cursor" data-toggle="tooltip" data-original-title="åŸŸåå·²ç»è¿‡éªŒè¯">âœ…</span>
                  {% else %}
                    <span class="cursor" data-toggle="tooltip" data-original-title="å¿…é¡»è®¾ç½®DNS">
                      <a href="{{ url_for('dashboard.domain_detail_dns', custom_domain_id=custom_domain.id) }}"
                         class="text-decoration-none">ğŸš«
                      </a>
                    </span>
                  {% endif %}
                </h5>

                <h6 class="card-subtitle mb-4 text-muted">
                  åˆ›å»ºäº {{ custom_domain.created_at | dt }} <br>
                  <span class="font-weight-bold">{{ custom_domain.nb_alias() }}</span> ä¸ªåˆ«å.
                  <br><br>

                  <b>æ”¶ä»¶ç®±:</b>
                  <i class="fe fe-info" data-toggle="tooltip"
                     title="ä½¿ç”¨æ­¤åŸŸåˆ›å»ºçš„åˆ«åå°†è‡ªåŠ¨å½’è¿™äº›é‚®ç®±æ‰€æœ‰">
                  </i>
                  <br>

                  {% set domain_mailboxes=custom_domain.mailboxes %}
                  <form method="post" class="mt-2">
                    <input type="hidden" name="form-name" value="update">
                    <input type="hidden" name="domain-id" value="{{ custom_domain.id }}">

                    <div class="d-flex">
                      <div class="flex-grow-1 mr-2">
                        <select data-width="100%" required
                                class="mailbox-select" multiple name="mailbox_ids">
                          {% for mailbox in mailboxes %}
                            <option value="{{ mailbox.id }}" {% if mailbox in domain_mailboxes %}
                                    selected {% endif %}>
                              {{ mailbox.email }}
                            </option>
                          {% endfor %}
                        </select>
                      </div>
                      <div>
                        <button class="btn btn-outline-primary btn-sm">ä¿å­˜</button>
                      </div>
                    </div>
                  </form>

                </h6>

                <a href="{{ url_for('dashboard.domain_detail', custom_domain_id=custom_domain.id) }}" class="mt-3">
                  è¯¦æƒ… â¡
                </a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-body">

              <form method="post" class="mt-2">
                {{ new_custom_domain_form.csrf_token }}
                <input type="hidden" name="form-name" value="create">

                <h2 class="h4">æ–°åŸŸå</h2>

                {{ new_custom_domain_form.domain(class="form-control", placeholder="my-domain.com", maxlength=128) }}
                {{ render_field_errors(new_custom_domain_form.domain) }}
                <div class="small-text">
                  è¯·ä½¿ç”¨å®Œæ•´è·¯å¾„åŸŸï¼Œä¾‹å¦‚ <em>my-subdomain.my-domain.com</em>
                </div>

                <div class="my-3 small-text alert alert-info">
                  é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ‚¨çš„åŸŸååˆ›å»ºçš„åˆ«åå½’æ‚¨çš„é»˜è®¤é‚®ç®± <b>{{ current_user.default_mailbox.email }}</b> æ‰€æœ‰ã€‚<br>
                  ä»¥ä¸‹é€‰é¡¹å…è®¸æ‚¨é€‰æ‹©æ–°åˆ«åè‡ªåŠ¨æ‰€å±çš„é‚®ç®±ã€‚
                </div>

                <select data-width="100%"
                        class="mailbox-select" multiple name="mailbox_ids">
                  {% for mailbox in mailboxes %}
                    <option value="{{ mailbox.id }}" {% if mailbox.id == current_user.default_mailbox_id %}
                            selected {% endif %}>
                      {{ mailbox.email }}
                    </option>
                  {% endfor %}
                </select>

                <button class="btn btn-lg btn-success mt-2">åˆ›å»º</button>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>
{% endblock %}

{% block script %}
  <script>
    $('.mailbox-select').multipleSelect();
  </script>
{% endblock %}