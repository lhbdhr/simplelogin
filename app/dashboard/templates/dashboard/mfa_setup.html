{% extends 'default.html' %}
{% set active_page = "setting" %}
{% block title %}
  MFA Setup
{% endblock %}

{% block head %}
  <script src="{{ url_for('static', filename='node_modules/qrious/dist/qrious.min.js') }}"></script>
{% endblock %}

{% block default_content %}
  <div class="card">
    <div class="card-body">
      <h1 class="h3">双因素认证 - TOTP</h1>
      <p>您需要在手机或电脑上使用 2FA 应用程序（例如 Google Authenticator 或 Authy）并扫描以下二维码：
      </p>

      <canvas id="qr"></canvas>

      <script>
        (function () {
          var qr = new QRious({
            element: document.getElementById('qr'),
            value: '{{otp_uri}}'
          });
        })();
      </script>

      <div class="mt-3 mb-2">
        或者您可以手动输入以下密钥：
      </div>

      <input class="form-control" disabled value="{{ current_user.otp_secret }}">


      <form method="post">
        {{ otp_token_form.csrf_token }}

        <div class="font-weight-bold mt-5">Token</div>
        <div class="small-text">请输入您的身份验证器应用程序中显示的 6 位数字。</div>

        {{ otp_token_form.token(class="form-control", placeholder="") }}
        {{ render_field_errors(otp_token_form.token) }}
        <button class="btn btn-lg btn-success mt-2">提交</button>
      </form>

    </div>
  </div>
{% endblock %}
