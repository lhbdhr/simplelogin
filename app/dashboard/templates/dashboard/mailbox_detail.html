{% extends 'default.html' %} {% set active_page = "mailbox" %} {% block title %}
Mailbox {{ mailbox.email }} {% endblock %} {% block head %}
<style>
  div[disabled] {
    pointer-events: none;
    opacity: 0.7;
  }
</style>
{% endblock %} {% block default_content %}

<div class="row">
  <div class="col">
    <h1 class="h3">
      {{ mailbox.email }} {% if mailbox.verified %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="æ”¶ä»¶ç®±å·²éªŒè¯"
      >
        âœ…
      </span>
      {% else %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="æ”¶ä»¶ç®±æœªéªŒè¯"
      >
        ğŸš«
      </span>
      {% endif %} {% if mailbox.pgp_enabled() %}
      <span
        class="cursor"
        data-toggle="tooltip"
        data-original-title="PGP å·²å¯ç”¨"
      >
        ğŸ—
      </span>
      {% endif %}
    </h1>

    {% if not mailbox.verified %}
    <div class="alert alert-info">
      é‚®ç®±å°šæœªéªŒè¯ï¼Œè¯·æ£€æŸ¥æ‚¨çš„æ”¶ä»¶ç®±/åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹ä¸­æ˜¯å¦æœ‰éªŒè¯é‚®ä»¶ã€‚
      <br />
      å¦‚éœ€å†æ¬¡æ¥æ”¶éªŒè¯é‚®ä»¶ï¼Œæ‚¨å¯ä»¥åˆ é™¤å¹¶é‡æ–°æ·»åŠ é‚®ç®±ã€‚
    </div>
    {% endif %}

    <!-- Change email -->
    <div class="card">
      <form
        method="post"
        enctype="multipart/form-data"
      >
        <input
          type="hidden"
          name="form-name"
          value="update-email"
        />
        {{ change_email_form.csrf_token }}

        <div class="card-body">
          <div class="card-title">ä¿®æ”¹æ”¶ä»¶ç®±åœ°å€</div>
          <div class="form-group">
            <label class="form-label">åœ°å€</label>

            <!-- Not allow user to change mailbox if there's a pending change -->
            {{ change_email_form.email(class="form-control",
            value=mailbox.email, readonly=pending_email != None) }} {{
            render_field_errors(change_email_form.email) }} {% if pending_email
            %}
            <div class="mt-2">
              <span class="text-danger">ç­‰å¾…æ›´æ”¹: {{ pending_email }}</span>
              <a
                href="{{ url_for('dashboard.cancel_mailbox_change_route', mailbox_id=mailbox.id) }}"
                class="btn btn-secondary btn-sm"
              >
                å–æ¶ˆæ”¶ä»¶ç®±ä¿®æ”¹
              </a>
            </div>
            {% endif %}
          </div>
          <button class="btn btn-primary">ä¿å­˜</button>
        </div>
      </form>
    </div>
    <!-- END Change email -->

    <div class="card">
      <div class="card-body">
        <div class="card-title">
          <div class="d-flex">
            é‚®ä»¶åŠ å¯† (PGP) {% if mailbox.pgp_finger_print %}
            <form method="post">
              <input
                type="hidden"
                name="form-name"
                value="toggle-pgp"
              />

              <label
                class="custom-switch cursor"
                style="padding-left: 1rem"
                data-toggle="tooltip"
                {%
                if
                mailbox.disable_pgp
                %}
                title="å¯ç”¨ PGP"
                {%
                else
                %}
                title="ç¦ç”¨ PGP"
                {%
                endif
                %}
              >
                <input type="checkbox" class="custom-switch-input"
                name="pgp-enabled" {{ "" if mailbox.disable_pgp else "checked"
                }}>
                <span class="custom-switch-indicator"></span>
              </label>
            </form>
            {% endif %}
          </div>

          <div class="small-text mt-1">
            é€šè¿‡å°†æ‚¨çš„ PGP å…¬é’¥å¯¼å…¥åŸé‚®é‚®ç®± {{ mailbox.email }} çš„ç”µå­é‚®ä»¶éƒ½å°†ä½¿ç”¨æ‚¨çš„å¯†é’¥è¿›è¡Œ <b>åŠ å¯†</b>ã€‚
            <br />
            {% if PGP_SIGNER %} 
            æ‰€æœ‰è½¬å‘çš„ç”µå­é‚®ä»¶éƒ½å°†ä½¿ç”¨<b>{{ PGP_SIGNER }} è¿›è¡Œç­¾åã€‚
            {% endif %}
          </div>
        </div>

        {% if not current_user.is_premium() %}
        <div
          class="alert alert-danger"
          role="alert"
        >
          æ­¤åŠŸèƒ½ä»…åœ¨é«˜çº§è®¡åˆ’ä¸­å¯ç”¨ã€‚
        </div>
        {% endif %}

        <form method="post">
          <div class="form-group">
            <label class="form-label">PGP Public Key</label>

            <textarea
              name="pgp"
              {%
              if
              not
              current_user.is_premium()
              %}
              disabled
              {%
              endif
              %}
              class="form-control"
              rows="10"
              placeholder="-----BEGIN PGP PUBLIC KEY BLOCK-----"
            >
{{ mailbox.pgp_public_key or "" }}</textarea
            >
          </div>

          <input
            type="hidden"
            name="form-name"
            value="pgp"
          />
          <button
            class="btn btn-primary"
            name="action"
            {%
            if
            not
            current_user.is_premium()
            %}
            disabled
            {%
            endif
            %}
            value="save"
          >
            ä¿å­˜
          </button>
          {% if mailbox.pgp_finger_print %}
          <button
            class="btn btn-danger float-right"
            name="action"
            value="remove"
          >
            ç§»é™¤
          </button>
          {% endif %}
        </form>
      </div>
    </div>

    <div
      class="card"
      {%
      if
      not
      mailbox.pgp_enabled()
      %}
      disabled
      {%
      endif
      %}
    >
      <form method="post">
        <input
          type="hidden"
          name="form-name"
          value="generic-subject"
        />

        <div class="card-body">
          <div class="card-title">
            å¯ç”¨ PGP æ—¶éšè—ç”µå­é‚®ä»¶ä¸»é¢˜
            <div class="small-text mt-1">
              å¯ç”¨ PGP åï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸ºè½¬å‘çš„ç”µå­é‚®ä»¶ä½¿ç”¨
              <b>é€šç”¨</b>
              ä¸»é¢˜ã€‚ç„¶åï¼ŒåŸå§‹ä¸»é¢˜å°†æ·»åŠ åˆ°ç”µå­é‚®ä»¶æ­£æ–‡ä¸­ã€‚
              <br />
              ç”±äº PGP ä¸åŠ å¯†ç”µå­é‚®ä»¶ä¸»é¢˜ï¼Œå¹¶ä¸”ç”µå­é‚®ä»¶ä¸»é¢˜
              å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå› æ­¤æ­¤é€‰é¡¹å°†è¿›ä¸€æ­¥ä¿æŠ¤æ‚¨çš„ç”µå­é‚®ä»¶å†…å®¹ã€‚
            </div>
          </div>
          <div class="alert alert-info">
            ç”±äºç”µå­é‚®ä»¶æ˜¯åŠ å¯†çš„ï¼Œåƒâ€œç»™æ‚¨å‘ç”µå­é‚®ä»¶â€è¿™æ ·çš„ä¸»é¢˜å¯èƒ½ä¼šè¢«æ‚¨çš„é‚®ç®±æ‹’ç»ï¼Œå› ä¸ºå®ƒå¬èµ·æ¥åƒåƒåœ¾é‚®ä»¶ã€‚
            <br />
            åƒâ€œåŠ å¯†ç”µå­é‚®ä»¶â€è¿™æ ·çš„ä¸»é¢˜æ•ˆæœä¼šæ›´å¥½ :)
          </div>

          <div class="form-group">
            <label class="form-label">é€šç”¨ä¸»é¢˜</label>

            <input name="generic-subject" {% if not mailbox.pgp_enabled() %}
            disabled {% endif %} class="form-control" maxlength="78"
            placeholder="åŠ å¯†ç”µå­é‚®ä»¶" value="{{ mailbox.generic_subject or
            "" }}" >
          </div>

          <button
            class="btn btn-primary"
            name="action"
            {%
            if
            not
            mailbox.pgp_enabled()
            %}
            disabled
            {%
            endif
            %}
            value="save"
          >
            ä¿å­˜
          </button>
          {% if mailbox.generic_subject %}
          <button
            class="btn btn-danger float-right"
            name="action"
            value="remove"
          >
            ç§»é™¤
          </button>
          {% endif %}
        </div>
      </form>
    </div>

    <hr />
    <h2 class="h4">é«˜çº§é€‰é¡¹</h2>

    {% if spf_available %}
    <div
      class="card"
      id="spf"
    >
      <form method="post">
        <input
          type="hidden"
          name="form-name"
          value="force-spf"
        />

        <div class="card-body">
          <div class="card-title">
            å¼ºåˆ¶ SPF
            <div class="small-text">
              ä¸ºäº†é˜²æ­¢ç”µå­é‚®ä»¶æ¬ºéª—ï¼ŒåŸé‚®é‚®ç®± ä¼šé˜»æ­¢ä»¥ä¸‹ç”µå­é‚®ä»¶
              <em
              data-toggle="tooltip"
              title="ä»¥æ‚¨çš„é‚®ç®±ä½œä¸ºå‘ä»¶äººåœ°å€çš„ç”µå­é‚®ä»¶"
              >
              ä¼¼ä¹
              </em>
              æ¥è‡ªæ‚¨çš„é‚®ç®±ï¼Œä½†å‘é€è‡ª
              <em
              data-toggle="tooltip"
              title="æ‚¨çš„é‚®ç®±ç”µå­é‚®ä»¶æœåŠ¡ä¸çŸ¥é“çš„ IP åœ°å€"
              >
              æœªçŸ¥
              </em>
              IP åœ°å€ã€‚
              <br />
              ä»…å½“æ‚¨çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆæ—¶æ‰å…³é—­æ­¤é€‰é¡¹:).
            </div>
          </div>
          <label
            class="custom-switch cursor mt-2 pl-0"
            data-toggle="tooltip"
            {%
            if
            mailbox.force_spf
            %}
            title="å¼ºåˆ¶ç¦ç”¨ SPF"
            {%
            else
            %}
            title="å¼ºåˆ¶å¯ç”¨ SPF"
            {%
            endif
            %}
          >
            <input type="checkbox" name="spf-status" class="custom-switch-input"
            {{ "checked" if mailbox.force_spf else "" }}>
            <span class="custom-switch-indicator"></span>
          </label>
        </div>
      </form>
    </div>
    {% endif %}

    <div
      class="card"
      id="authorized-address"
    >
      <div class="card-body">
        <div class="card-title">
          ç»è¿‡æˆæƒçš„é‚®ä»¶åœ°å€
          <div class="small-text">
            ä»è¿™äº›åœ°å€å‘é€åˆ°
            <b>åå‘åˆ«å</b>
            çš„ç”µå­é‚®ä»¶è¢«è§†ä¸ºä» {{ mailbox.email }} å‘é€
          </div>
        </div>
        {% if mailbox.authorized_addresses | length == 0 %} {% else %}
        <ul>
          {% for authorized_address in mailbox.authorized_addresses %}
          <li>
            {{ authorized_address.email }}
            <form
              method="post"
              action="#authorized-address"
              style="display: inline"
            >
              <input
                type="hidden"
                name="form-name"
                value="delete-authorized-address"
              />
              <input
                type="hidden"
                name="authorized-address-id"
                value="{{ authorized_address.id }}"
              />
              <input
                type="submit"
                class="btn btn-sm btn-outline-warning"
                value="åˆ é™¤"
              />
            </form>
          </li>
          {% endfor %}
        </ul>
        {% endif %}

        <form
          method="post"
          action="#authorized-address"
          class="form-inline"
        >
          <input
            type="hidden"
            name="form-name"
            value="add-authorized-address"
          />
          <input
            type="email"
            name="email"
            size="50"
            class="form-control"
          />
          <input
            type="submit"
            class="btn btn-primary"
            value="Add"
          />
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block script %}
<script>
  $('.custom-switch-input').change(function (e) {
    $(this).closest('form').submit()
  })
</script>
{% endblock %}
