{% extends 'default.html' %}

{% block title %}
  è´¦å•
{% endblock %}

{% block head %}
{% endblock %}

{% block default_content %}
  <div class="card">
    <div class="card-body">
      <h1 class="h3 mb-5"> è´¦å• </h1>

      {% if sub.cancelled %}
        <p>
          æ‚¨ä½¿ç”¨çš„æ˜¯ <b>{{ sub.plan_name() }}</b> è®¡åˆ’ã€‚<br>
          æ‚¨å·²å–æ¶ˆè®¢é˜…ï¼Œè®¢é˜…å°†äº {{ sub.next_bill_date.strftime("%Y-%m-%d") }} è¿‡æœŸ
        </p>

        <hr>
        <p>
          å¦‚æœæ‚¨æ”¹å˜ä¸»æ„ï¼Œå¯ä»¥å†æ¬¡è®¢é˜… SimpleLoginï¼Œä½†è¯·æ³¨æ„ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå…¨æ–°çš„è®¢é˜…ï¼Œå¹¶ä¸”æ‚¨çš„ä»˜æ¬¾æ–¹å¼å°†<b>ç«‹å³</b>æ‰£æ¬¾ã€‚
          <br>
          æˆ‘ä»¬å°†åœ¨è®¢é˜…ç»“æŸæ—¶å‘æ‚¨å‘é€ä¸€å°ç”µå­é‚®ä»¶ï¼Œå› æ­¤æ‚¨ä¹Ÿè®¸å¯ä»¥åœ¨é‚£æ—¶å‡çº§ã€‚
          <br>
          <a href="{{ url_for('dashboard.pricing') }}" class="btn btn-primary mt-2">é‡æ–°è®¢é˜…</a>
        </p>

      {% else %}
        <p>
          æ‚¨ä½¿ç”¨çš„æ˜¯ <b>{{ sub.plan_name() }}</b> è®¡åˆ’ã€‚éå¸¸æ„Ÿè°¢æ‚¨æ”¯æŒ
          SimpleLoginã€‚ğŸ™Œ <br>
          ä¸‹ä¸€ä¸ªè®¡è´¹å‘¨æœŸä» {{ sub.next_bill_date.strftime("%Y-%m-%d") }} å¼€å§‹ã€‚
        </p>

        <div class="mt-3">
          ç‚¹å‡»æ­¤å¤„æ›´æ–°æˆ‘ä»¬çš„ä»˜æ¬¾åˆä½œä¼™ä¼´ Paddle çš„è´¦å•ä¿¡æ¯ï¼š<br>
          <a class="btn btn-outline-success mt-2" href="{{ sub.update_url }}"> æ›´æ–°è´¦å•ä¿¡æ¯</a>
        </div>
        <hr>
        <div class="mt-6">
          <h4>ä¿®æ”¹ä»˜è´¹è®¡åˆ’</h4>
          æ‚¨å¯ä»¥éšæ—¶æ›´æ”¹è®¡åˆ’ã€‚<br>
          è¯·æ³¨æ„ï¼Œæ–°çš„è®¡è´¹å‘¨æœŸç«‹å³å¼€å§‹
          å³ï¼Œå½“æ‚¨ä»æœˆåº¦è®¡åˆ’åˆ‡æ¢æˆ–åä¹‹äº¦ç„¶æ—¶ï¼Œæ‚¨å°†<b>ç«‹å³</b>æ”¯ä»˜å¹´è´¹
          <b>æ— éœ€æŒ‰æ¯”ä¾‹è®¡ç®—</b>ã€‚<br>

          è¦æ›´æ”¹è®¡åˆ’ï¼Œæ‚¨ä¹Ÿå¯ä»¥å–æ¶ˆå½“å‰è®¡åˆ’å¹¶åœ¨<b>è¯¥è®¡åˆ’ç»“æŸ</b>å‰è®¢é˜…æ–°è®¡åˆ’ã€‚

          {% if sub.plan == PlanEnum.yearly %}
            <form method="post" onsubmit="return confirm('This will change your current subscription plan, please confirm');">
              <input type="hidden" name="form-name" value="change-monthly">
              <button class="btn btn-outline-primary mt-2">Change to Monthly Plan</button>
            </form>
          {% else %}
            <form method="post" onsubmit="return confirm('This will change your current subscription plan, please confirm');">
              <input type="hidden" name="form-name" value="change-yearly">
              <button class="btn btn-outline-primary mt-2">æ”¹ä¸ºå¹´ä»˜</button>
            </form>
          {% endif %}
        </div>

        <hr>

        <div>
          <h4>å–æ¶ˆè®¢é˜…è®¡åˆ’</h4>
          ä¸æƒ³å†ä¿æŠ¤æ‚¨çš„æ”¶ä»¶ç®±äº†å—ï¼Ÿ <br>

          <form method="post">
            <input type="hidden" name="form-name" value="cancel">

            <span class="cancel btn btn-outline-danger mt-2">
            å–æ¶ˆè®¢é˜… <i class="fe fe-alert-triangle text-danger"></i>
          </span>
          </form>

        </div>
      {% endif %}
    </div>
  </div>

{% endblock %}

{% block script %}
  <script>

    $(".cancel").on("click", function (e) {
      let that = $(this);

      bootbox.confirm({
        message: "This operation is irreversible, please confirm.",
        buttons: {
          confirm: {
            label: 'Cancel subscription',
            className: 'btn-danger'
          },
          cancel: {
            label: 'Close',
            className: 'btn-outline-primary'
          }
        },
        callback: function (result) {
          if (result) {
            that.closest("form").submit();
          }
        }
      })
    });

  </script>
{% endblock %}