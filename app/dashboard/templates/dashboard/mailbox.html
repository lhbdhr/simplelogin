{% extends 'default.html' %} {% set active_page = "mailbox" %} {% block title %}
Mailboxes {% endblock %} {% block default_content %}
<div class="row">
  <div class="col">
    <h1 class="h3">
      Mailboxes
      <a
        class="ml-3 text-info"
        style="font-size: 12px"
        data-toggle="collapse"
        href="#howtouse"
        role="button"
        aria-expanded="false"
        aria-controls="collapseExample"
      >
        å¦‚ä½•ä½¿ç”¨
        <i class="fe fe-chevrons-down"></i>
      </a>
    </h1>

    {% if not current_user.is_premium() %}
    <div
      class="alert alert-danger"
      role="alert"
    >
      æ­¤åŠŸèƒ½ä»…åœ¨é«˜çº§è®¡åˆ’ä¸­å¯ç”¨ã€‚
    </div>
    {% endif %}

    <div
      class="alert alert-primary collapse {% if mailboxes|length == 1 %} show {% endif %}"
      id="howtouse"
      role="alert"
    >
      <em>é‚®ç®±</em>
      åªæ˜¯å¦ä¸€ä¸ªä¸ªäººç”µå­é‚®ä»¶åœ°å€ã€‚åˆ›å»ºæ–°åˆ«åæ—¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©æ‹¥æœ‰æ­¤åˆ«åçš„é‚®ç®±ï¼Œå³ï¼š
      <br />
      - å‘é€åˆ°æ­¤åˆ«åçš„æ‰€æœ‰ç”µå­é‚®ä»¶éƒ½å°†è½¬å‘åˆ°æ­¤é‚®ç®±
      <br />
      - æ‚¨å¯ä»¥ä»æ­¤é‚®ç®±å›å¤/å‘é€ç”µå­é‚®ä»¶ã€‚
      <br />
      <br />

      æ³¨å†Œåï¼Œå°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªé‚®ç®±ï¼Œå…¶ä¸­åŒ…å«æ‚¨çš„ç”µå­é‚®ä»¶
      <b>{{ current_user.email }}</b>
      <br />
      <br />

      é‚®ç®±ä¸ä¸€å®šæ˜¯æ‚¨æœ¬äººçš„ç”µå­é‚®ä»¶ï¼šå¦‚æœæ‚¨æƒ³ä¸ºæ‚¨çš„å¥½å‹åˆ›å»ºåˆ«åï¼Œå®ƒå¯ä»¥æ˜¯æ‚¨æœ‹å‹çš„ç”µå­é‚®ä»¶ã€‚
    </div>

    <div class="row">
      {% for mailbox in mailboxes %}
      <div class="col-12 col-lg-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">
              {{ mailbox.email }} {% if mailbox.verified %}
              <span
                class="cursor"
                data-toggle="tooltip"
                data-original-title="é‚®ä»¶åœ°å€å·²éªŒè¯"
              >
                âœ…
              </span>
              {% else %}
              <span
                class="cursor"
                data-toggle="tooltip"
                data-original-title="é‚®ä»¶åœ°å€ä¸ºæœªéªŒè¯"
              >
                ğŸš«
              </span>
              {% endif %} {% if mailbox.pgp_enabled() %}
              <span
                class="cursor"
                data-toggle="tooltip"
                data-original-title="PGP å·²å¯ç”¨"
              >
                ğŸ—
              </span>
              {% endif %} {% if mailbox.id == current_user.default_mailbox_id %}
              <div
                class="badge badge-primary float-right"
                data-toggle="tooltip"
                title="åˆ›å»ºæ–°çš„éšæœºåˆ«åæ—¶ï¼Œå®ƒå±äºé»˜è®¤é‚®ç®±"
              >
                é»˜è®¤æ”¶ä»¶ç®±
              </div>
              {% endif %}
            </h5>

            <h6 class="card-subtitle mb-2 text-muted">
              åˆ›å»ºäº {{ mailbox.created_at | dt }}
              <br />
              æ‹¥æœ‰
              <span class="font-weight-bold">{{ mailbox.nb_alias() }}</span>
              ä¸ªåˆ«å
              <br />
            </h6>

            <a
              href="{{ url_for('dashboard.mailbox_detail_route', mailbox_id=mailbox.id) }}"
            >
              ç¼–è¾‘ â¡
            </a>
          </div>

          <div class="card-footer p-0">
            <div class="row">
              {% if mailbox.verified %}
              <div class="col">
                <form method="post">
                  <input
                    type="hidden"
                    name="form-name"
                    value="set-default"
                  />
                  <input
                    type="hidden"
                    class="mailbox"
                    value="{{ mailbox.email }}"
                  />
                  <input
                    type="hidden"
                    name="mailbox-id"
                    value="{{ mailbox.id }}"
                  />
                  <button
                    class="card-link btn btn-link {% if mailbox.id == current_user.default_mailbox_id %} disabled {% endif %}"
                  >
                    è®¾ä¸ºé»˜è®¤æ”¶ä»¶ç®±
                  </button>
                </form>
              </div>
              {% endif %}

              <div class="col">
                <form method="post">
                  <input
                    type="hidden"
                    name="form-name"
                    value="delete"
                  />
                  <input
                    type="hidden"
                    class="mailbox"
                    value="{{ mailbox.email }}"
                  />
                  <input
                    type="hidden"
                    name="mailbox-id"
                    value="{{ mailbox.id }}"
                  />
                  <span
                    class="card-link btn btn-link text-danger float-right delete-mailbox {% if mailbox.id == current_user.default_mailbox_id %} disabled {% endif %}"
                  >
                    åˆ é™¤
                  </span>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <form
      method="post"
      class="mt-2"
    >
      {{ new_mailbox_form.csrf_token }}
      <input
        type="hidden"
        name="form-name"
        value="create"
      />

      <h2 class="h4">æ–°å»ºæ”¶ä»¶ç®±</h2>

      {{ new_mailbox_form.email(class="form-control",
      placeholder="email@example.com") }} {{
      render_field_errors(new_mailbox_form.email) }}
      <div class="mt-2 small-text alert alert-info">
        é‚®ç®±ä¸èƒ½æ˜¯ä¸€æ¬¡æ€§æˆ–è½¬å‘ç”µå­é‚®ä»¶åœ°å€ã€‚
      </div>

      <button class="btn btn-lg btn-success mt-2">åˆ›å»º</button>
    </form>
  </div>
</div>
{% endblock %} {% block script %}
<script>
  $('.delete-mailbox').on('click', function (e) {
    let mailbox = $(this).parent().find('.mailbox').val()

    let that = $(this)
    let message =
      `æ­¤é‚®ç®± <b>${mailbox}</b> æ‹¥æœ‰çš„æ‰€æœ‰åˆ«åä¹Ÿå°†è¢«åˆ é™¤ï¼Œ` + 'è¯·ç¡®è®¤ã€‚'

    bootbox.confirm({
      message: message,
      buttons: {
        confirm: {
          label: 'æˆ‘å·²äº†è§£ï¼Œç¡®è®¤åˆ é™¤',
          className: 'btn-danger',
        },
        cancel: {
          label: 'å–æ¶ˆ',
          className: 'btn-outline-primary',
        },
      },
      callback: function (result) {
        if (result) {
          that.closest('form').submit()
        }
      },
    })
  })
</script>
{% endblock %}
